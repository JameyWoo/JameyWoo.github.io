<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>《Architecture of Database System》- 数据库系统架构 - 姬小野的部落</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="姬小野" /><meta name="description" content="概述 本博文主要介绍数据库系统的基本架构，内容主要包括对《Architecture of Database System》的总结和理解。本文只是对数据库基本架构进行" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.104.3 with theme even" />


<link rel="canonical" href="https://fiveplus.top/post/%E6%95%B0%E6%8D%AE%E5%BA%93/architecture-of-database-system/" />
<link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../favicon-16x16.png">
<link rel="manifest" href="../../../manifest.json">
<link rel="mask-icon" href="../../../safari-pinned-tab.svg" color="#5bbad5">



<link href="../../../sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="《Architecture of Database System》- 数据库系统架构" />
<meta property="og:description" content="概述 本博文主要介绍数据库系统的基本架构，内容主要包括对《Architecture of Database System》的总结和理解。本文只是对数据库基本架构进行" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://fiveplus.top/post/%E6%95%B0%E6%8D%AE%E5%BA%93/architecture-of-database-system/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-08-22T17:18:51+08:00" />
<meta property="article:modified_time" content="2021-08-22T17:18:51+08:00" />

<meta itemprop="name" content="《Architecture of Database System》- 数据库系统架构">
<meta itemprop="description" content="概述 本博文主要介绍数据库系统的基本架构，内容主要包括对《Architecture of Database System》的总结和理解。本文只是对数据库基本架构进行"><meta itemprop="datePublished" content="2021-08-22T17:18:51+08:00" />
<meta itemprop="dateModified" content="2021-08-22T17:18:51+08:00" />
<meta itemprop="wordCount" content="5859">
<meta itemprop="keywords" content="数据库," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="《Architecture of Database System》- 数据库系统架构"/>
<meta name="twitter:description" content="概述 本博文主要介绍数据库系统的基本架构，内容主要包括对《Architecture of Database System》的总结和理解。本文只是对数据库基本架构进行"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="../../../" class="logo">姬小野</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="../../../">
        <li class="mobile-menu-item">主页</li>
      </a><a href="../../../post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="../../../tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="../../../categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="../../../about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="../../../" class="logo">姬小野</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="../../../">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="../../../post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="../../../tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="../../../categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="../../../about/">关于</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">《Architecture of Database System》- 数据库系统架构</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-08-22 </span>
        <div class="post-category">
            <a href="../../../categories/%E8%AE%BA%E6%96%87%E7%B3%BB%E5%88%97/"> 论文系列 </a>
            </div>
          <span class="more-meta"> 5859 words </span>
          <span class="more-meta"> 12 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#概述">概述</a></li>
    <li><a href="#基本架构">基本架构</a></li>
    <li><a href="#进程模型">进程模型</a>
      <ul>
        <li><a href="#操作系统的进程与线程">操作系统的进程与线程</a></li>
        <li><a href="#dbms的进程线程模型">DBMS的进程/线程模型</a></li>
        <li><a href="#准入控制">准入控制</a></li>
      </ul>
    </li>
    <li><a href="#并行架构进程和内存协调">并行架构：进程和内存协调</a>
      <ul>
        <li><a href="#shared-memory-共享内存">Shared-Memory 共享内存</a></li>
        <li><a href="#shared-nothing-无共享">Shared-Nothing 无共享</a></li>
        <li><a href="#shared-disk共享磁盘">Shared-Disk共享磁盘</a></li>
        <li><a href="#numa-非均衡内存访问">NUMA 非均衡内存访问</a></li>
        <li><a href="#shared-storage-补充">Shared-Storage (补充)</a></li>
      </ul>
    </li>
    <li><a href="#关系查询处理器">关系查询处理器</a>
      <ul>
        <li><a href="#ddl和dml">DDL和DML</a></li>
        <li><a href="#查询解析">查询解析</a></li>
        <li><a href="#查询重写">查询重写</a></li>
        <li><a href="#查询优化器">查询优化器</a></li>
        <li><a href="#查询执行器">查询执行器</a></li>
        <li><a href="#数据仓库">数据仓库</a></li>
      </ul>
    </li>
    <li><a href="#访问方法索引">访问方法/索引</a></li>
    <li><a href="#存储管理">存储管理</a></li>
    <li><a href="#事务并发控制和恢复">事务：并发控制和恢复</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#共享组件">共享组件</a></li>
    <li><a href="#一个sql的完整生命周期">一个SQL的完整生命周期</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="概述">概述</h2>
<p>本博文主要介绍数据库系统的基本架构，内容主要包括对《Architecture of Database System》的总结和理解。本文只是对数据库基本架构进行介绍，各个模块更详细深入的内容可以看本站点 <a href="https://jameywoo.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93">数据库tag</a> 的其它相关内容。</p>
<blockquote>
<p>Joseph M. Hellerstein, Michael Stonebraker, James Hamilton. <strong>Architecture of a Database System</strong>. Foundations
and Trends in Databases, 1, 2 (2007).</p>
</blockquote>
<p>Architecture of Database System是一篇2007年发表的论文（或者书），一共119页，从体系结构方面对数据库的实现原理进行了介绍。其作者都是在数据库领域非常著名的研究者，Joseph M. Hellerstein, Michael Stonebraker参与了一本叫做《Readings in Database Systems》的小书（也叫redbook）的发行，截至目前，已经出版了第五版，这本小书分为十来个章节，分别简要介绍数据库领域的经典论文，从传统的RDBMS到New DBMS Architectures，是非常好的论文阅读扩展方向。</p>
<p>Michael Stonebraker与2014年获得了图灵奖，他参与的项目有<strong>Aurora</strong>，<a href="https://zh.wikipedia.org/w/index.php?title=C-Store&amp;action=edit&amp;redlink=1">C-Store</a>，<strong>H-Store</strong>，<strong>Morpheus</strong>，以及<strong>SciDB</strong>系统等，同时也是以下数据库公司的创始人：<a href="https://zh.wikipedia.org/w/index.php?title=Ingres_(database)&amp;action=edit&amp;redlink=1">Ingres</a>, <a href="https://zh.wikipedia.org/w/index.php?title=Illustra&amp;action=edit&amp;redlink=1">Illustra</a>, Cohera, <a href="https://zh.wikipedia.org/w/index.php?title=StreamBase_Systems&amp;action=edit&amp;redlink=1">StreamBase Systems</a>, <a href="https://zh.wikipedia.org/wiki/Vertica">Vertica</a>，以及<a href="http://www.voltdb.com/">VoltDB</a>，可以说是数据库领域的超级大牛。</p>
<p>这篇文章从<strong>进程模型、并行体系结构、关系查询处理器、存储管理、事务、共享组件</strong>等方面对数据库架构进行了介绍。虽然有的内容较老，新技术不断涌现，但这篇论文仍不失为了解数据库体系的绝佳材料。</p>
<h2 id="基本架构">基本架构</h2>
<p>一个DBMS主要包括如下组件</p>
<p><img src="https://raw.githubusercontent.com/JameyWoo/FigureBed/master/hugo_imgs/image-20211009145540867.png" alt="你好"></p>
<p>模块较多，但主体模块如下：</p>
<ol>
<li>
<p>通信管理器</p>
<ul>
<li>
<p>通过ODBC/JDBC来连接DBMS（二层架构）</p>
</li>
<li>
<p>也有三层结构，客户端连接一个中间层（代理层），中间层和DBMS连接</p>
</li>
</ul>
</li>
<li>
<p>进程管理器</p>
<ul>
<li>
<p>准入控制</p>
</li>
<li>
<p>进程模型，如多进程模型、线程池等</p>
</li>
</ul>
</li>
<li>
<p>查询处理器</p>
<ul>
<li>
<p>查询解析器</p>
<ul>
<li>词法分析，语法分析</li>
<li>权限管理</li>
</ul>
</li>
<li>
<p>查询优化器</p>
<ul>
<li>为查询生成性能最优（但不一定）的执行计划</li>
<li>进行代价评估</li>
</ul>
</li>
<li>
<p>查询执行器</p>
<ul>
<li>调用存储引擎的接口，执行查询</li>
</ul>
</li>
</ul>
</li>
<li>
<p>存储管理器（即存储引擎）</p>
<ul>
<li>
<p>缓冲管理器：磁盘和内存的缓冲管理</p>
</li>
<li>
<p>事务管理器：ACID事务</p>
</li>
<li>
<p>日志管理器：持久化，故障恢复</p>
</li>
<li>
<p>锁管理器：解决并发冲突</p>
</li>
</ul>
</li>
<li>
<p>目录管理</p>
</li>
</ol>
<blockquote>
<p>点评：想要实现一个功能较完整的哪怕是玩具级别的DBMS也不是件简单的事，包含的模块太多了。了解理论简单，但实现起来细节爆炸式增长。</p>
</blockquote>
<h2 id="进程模型">进程模型</h2>
<p>介绍数据库，怎么讲起进程模型来了？</p>
<p>数据库也是运行在操作系统上的软件，所以是绕不开操作系统的，任何建立在OS上的应用程序，都需要考虑其进程模型，以及了解操作系统的进程原理，以最大化软件性能。</p>
<h3 id="操作系统的进程与线程">操作系统的进程与线程</h3>
<p>操作系统的进程和线程主要分为三类：</p>
<ol>
<li>
<p>操作系统进程</p>
</li>
<li>
<p>操作系统线程（内核线程）</p>
</li>
<li>
<p>轻量级线程（应用层次）</p>
<ul>
<li>
<p>仅在用户空间调度而没有内核的参与，切换快速；</p>
</li>
<li>
<p>当发生中断操作时，整个进程都会中断；可通过某些方式避免</p>
<ul>
<li>
<p>只接受无中断的异步 IO 操作</p>
</li>
<li>
<p>不调用可以导致中断的系统操作</p>
</li>
</ul>
</li>
<li>
<p>纯粹的轻量级线程并不好，更好的是 M:N 的线程模型，如 Go 语言的Goroutine实现方式</p>
</li>
</ul>
</li>
</ol>
<h3 id="dbms的进程线程模型">DBMS的进程/线程模型</h3>
<p>而DBMS的进程/线程模型是不固定的，每个系统都有其实现方式，主要分为以下几种类型</p>
<ol>
<li>
<p>多进程模型</p>
<ul>
<li>
<p>每个 DBMS worker 拥有一个进程，也可以实现成进程池</p>
<ul>
<li>DBMS worker 是指DBMS 中为客户端工作的线程</li>
</ul>
</li>
<li>
<p>优点是开发简单，调试简单</p>
</li>
<li>
<p>缺点是这种模型需要广泛使用共享内存，因为需要定义很多共享的数据结构，如锁机制，缓冲池；</p>
</li>
<li>
<p>在现在应该基本不使用这种模型了吧，应该主要使用线程池了。</p>
</li>
</ul>
</li>
<li>
<p>多线程模型</p>
<ul>
<li>
<p>每个 DBMS worker 拥有一个线程，以线程池的方式提供服务</p>
</li>
<li>
<p>优点是线程共享一个进程空间</p>
</li>
<li>
<p>缺点如下</p>
<ul>
<li>
<p>操作系统不对线程提供溢出和指针的保护，导致一个线程可能影响其他的线程</p>
</li>
<li>
<p>多线程调试困难</p>
</li>
<li>
<p>兼容性不好，因为不同的系统在多线程接口上的实现不是很统一（现在应该比较统一了）</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>进程模型的选择依赖于共享空间，因为不同的进程模型在共享空间上的表现是不一致的，而这需要开发人员权衡利弊</strong></p>
<ul>
<li>
<p>磁盘 IO 缓冲区</p>
<ul>
<li>
<p>磁盘 IO：缓冲池</p>
</li>
<li>
<p>日志 IO：日志尾部</p>
</li>
</ul>
</li>
<li>
<p>客户端通信缓冲区</p>
<ul>
<li>客户端是 pull 模型，通过发送 SQL FETCH 请求不断地获取结果元组</li>
</ul>
</li>
<li>
<p>锁表</p>
<ul>
<li>被所有 DBMS worker 共享</li>
</ul>
</li>
</ul>
<h3 id="准入控制">准入控制</h3>
<p>多用户系统负载不断升高，吞吐量将达到上限，因此不能无限地允许客户端连接。任何好的多用户系统都有准入控制机制，在系统没有充足资源的情况下，新的任务不被接受。如果拥有一个好的准入控制器，系统将在过载情况下发生比较优雅的性能衰退：事务延迟将随着到达率的增加而适当增加，但吞吐量一直保持在峰值。</p>
<p>准入控制需要控制客户端连接数在一个临界值之下，避免网络连接数这类资源过度消耗（socket资源）。在 DBMS 关系查询处理器上实现，准入控制器在查询语句转换和优化完成后执行这一步操作，然后可以估算这个语句需要的资源，然后根据资源消耗来决定是否让它执行。</p>
<h2 id="并行架构进程和内存协调">并行架构：进程和内存协调</h2>
<p>主要分为三类：Shared-Memory 共享内存、Shared-Nothing 无共享、Shared-Disk 共享磁盘。</p>
<h3 id="shared-memory-共享内存">Shared-Memory 共享内存</h3>
<p>它是一种单节点结构，区别于共享磁盘和无共享模式的『多节点』。包含两种，SMP（SMP: Symmetrical Multi-Processing 对称多处理器） 和 多核系统 的统称。</p>
<p>基本结构：一个Ram，一个Disk，多个CPU（或多核）</p>
<p><img src="https://raw.githubusercontent.com/JameyWoo/FigureBed/master/hugo_imgs/image-20211009152518877.png" alt="image-20211009152518877"></p>
<p>SMP架构也是目前最普遍的一种单机架构，像平时用的服务器或者个人电脑大多数都是 SMP，多核 CPU+共用内存。当然，严格来讲这里的处理器是物理处理器，一个有多核的处理器架构和这个是比较类似，也可以算作 SMP 架构。</p>
<h3 id="shared-nothing-无共享">Shared-Nothing 无共享</h3>
<p>mapreduce，TiDB等系统(Google 系)就是这种 Shared-Nothing 架构，以低成本的方式构建超大规模分布式集群，每一个服务器都是廉价的。</p>
<p>结构</p>
<p><img src="https://raw.githubusercontent.com/JameyWoo/FigureBed/master/hugo_imgs/image-20211009152719861.png" alt="image-20211009152719861"></p>
<p>无共享架构里要解决的问题是节点故障问题，有以下三种方法</p>
<ol>
<li>
<p>如果有一个节点故障，就停止运行所有的节点（牺牲可用性）</p>
</li>
<li>
<p>允许正常的节点上继续查询，跳过故障节点（数据的完整性得不到保证）</p>
</li>
<li>
<p>采用冗余方案，节点故障后通过副本恢复（目前最常使用的方法）</p>
<ul>
<li>
<p>同步复制 / 异步复制</p>
</li>
<li>
<p>Raft/Paxos 多副本</p>
</li>
</ul>
</li>
</ol>
<p>目前，无共享架构非常普遍，具备无与伦比的可扩展性和低成本特性。</p>
<h3 id="shared-disk共享磁盘">Shared-Disk共享磁盘</h3>
<p>多个处理器，具有独立的内存（不可相互访问），共享磁盘。这种架构非常适合 存储区域网络(SAN: Storage Area Networks)。什么是存储区域网络？概念及应用一篇学会 - ielab的文章 - 知乎https://zhuanlan.zhihu.com/p/339576871</p>
<p>这个架构看起来很像Aurora那种Shared-Storage架构，但还是有一些区别的。</p>
<p><img src="https://raw.githubusercontent.com/JameyWoo/FigureBed/master/hugo_imgs/image-20211009153013779.png" alt="image-20211009153013779"></p>
<p>它的优点是：单个 DBMS 处理节点发生故障不会影响其他节点访问整个数据库，因为数据保存在磁盘上</p>
<h3 id="numa-非均衡内存访问">NUMA 非均衡内存访问</h3>
<p>全称：NUMA: Non-Uniform Memory Access，它属于无共享系统和共享内存系统的中间地带，每一个内存和 CPU 相结合的子集通常被称为一个 pod（k8s 也有 pod 的概念），NUMA 集群没有成功取得任何显著的份额。</p>
<h3 id="shared-storage-补充">Shared-Storage (补充)</h3>
<p>shared-storage（共享存储），意为将本地盘存储换成了分布式共享存储。</p>
<p>PolarDB-X官方有一篇文章介绍相关内容：数据库架构杂谈（1）云数据库架构 - PolarDB-X的文章 - 知乎https://zhuanlan.zhihu.com/p/321353390：</p>
<ul>
<li>现在的分布式数据库基本分为两类架构：shared-storage(AWS系) 和 shared-nothing(Google系)</li>
<li>Aurora（对标 spanner）是 shared-storage 的代表；PolarDB 也是这种架构
<ul>
<li>Aurora 是基于 MySQL 的</li>
</ul>
</li>
<li>Spanner（同 TiDB，CockroachDB）是 shared-nothing 的代表</li>
</ul>
<p>TiDB是属于shared-nothing还是shared-storage数据库？ - 申砾的回答 - 知乎https://www.zhihu.com/question/55613676/answer/145770653：</p>
<ul>
<li>
<p>这个回答作者是 PingCAP 的一名开发人员，应该比较可信</p>
</li>
<li>
<p>有的文章说 TiDB 是 Shared-Storage，我不太认可</p>
</li>
</ul>
<h2 id="关系查询处理器">关系查询处理器</h2>
<h3 id="ddl和dml">DDL和DML</h3>
<ul>
<li>
<p>DDL是数据库定义语言，如Create Table，Create Index</p>
<p>DDL通常并不是关系查询处理器处理的，而是通过存储管理器和目录管理器来实现的。也有例外。</p>
</li>
<li>
<p>DML是数据库操作语言，负责增删改查如：INSERT, DELETE, UPDATE, SELECT</p>
</li>
</ul>
<h3 id="查询解析">查询解析</h3>
<p><strong>解析的目的</strong></p>
<ul>
<li>
<p>检查该查询是否被正确定义（语法、语义分析）</p>
</li>
<li>
<p>解决名字和引用（处理别名，转化成数据库内部的完整表示）</p>
</li>
<li>
<p>将查询转化为优化器使用的内部形式（即中间表示，例如抽象语法树，有向无环图）</p>
</li>
<li>
<p>检查用户是否有<strong>权限</strong>执行这个查询</p>
</li>
</ul>
<p><strong>一个查询解析的流程</strong></p>
<ol>
<li>
<p>解析器首先将from后面的表名规范化为：“服务器. 数据库. 模式. 表名” 或者 “数据库. 模式. 表名”</p>
<ul>
<li>
<p>#问题 模式是什么？数据库后面不就是表名吗？不同数据库有不同的层级结构，有的可能没有模式吧。模式应该是schema，在mysql上就是DataBase</p>
</li>
<li>
<p>好奇怪，在Google上搜索“表名规范化”搜到的根本不是这一类东西。。。都是表的规范命名方法；说明这个名词也比较老了现在用的不多了</p>
</li>
</ul>
</li>
<li>
<p>规范表名之后，查询处理器调用<strong>目录管理器（管理表的元数据），看表是否被注册</strong></p>
</li>
<li>
<p>类型检查，看类型是否正确或兼容（跟编译原理一样，解析部分其实就是编译的前端部分）</p>
</li>
<li>
<p>权限检查。有时候这部分在运行的时候进行，因为权限有可能跟值有关。</p>
</li>
<li>
<p>被传递到重写模块进行重写。</p>
</li>
</ol>
<h3 id="查询重写">查询重写</h3>
<p>查询重写模块，或重写器，<strong>负责简化和标准化查询</strong>，而无需改变查询语义。查询重写模块通常输出一个查询的内部表示，这种输出形式和它接受作为输入的内部格式相同。<strong>并不是表面的SQL语句重写，而是对中间表示重写</strong>（如抽象语法树），要么发生在查询解析的后期阶段，要么发生在查询优化的前期阶段（总之是两阶段之间）。</p>
<h4 id="重写职责">重写职责</h4>
<ul>
<li>
<p>视图重写</p>
<p>重写器会从目录管理器中检索出视图的定义，将视图转化为实际的表；这个过程是<strong>递归的（视图可嵌套）</strong>，直到表达式里只有表，没有视图</p>
</li>
<li>
<p>常量运算表达式</p>
<p>简化表达式，如将 x &lt; 10 + 2简化为 x &lt; 12</p>
</li>
<li>
<p>谓词逻辑重写</p>
<ul>
<li>如谓词逻辑 x &lt; 10 AND x &gt; 10，这种就直接重写为 FALSE；（有点像上一个）。</li>
<li>上面例子看上去很奇怪，但其实谓词有时候隐藏在视图中，而外部用这个表看不到，所以可能出现上面的特殊情况。</li>
<li>谓词逻辑重写还可以通过<strong>谓词传递性</strong>引入新的谓词，从而增加了优化器选择方案的能力。</li>
</ul>
</li>
<li>
<p>语义优化</p>
</li>
<li>
<p>子查询的平面化等启发式重写</p>
</li>
</ul>
<blockquote>
<p>点评：查询重写在解析器和优化器之间，其行为表现得非常像优化（事实上，他的目的就是优化），所以我觉得也可以将其归类到优化器中，事实上很多其它介绍数据库架构的文章是这么做的。但是，视图重写这一个功能，如果放到优化器中，字面意思上容易让人感到困惑，而放到“查询重写器”中，就让人觉得很有道理，所以查询重写器的存在还是很合理的。</p>
</blockquote>
<h3 id="查询优化器">查询优化器</h3>
<blockquote>
<p>优化器是数据库中最复杂的模块之一，尽最大可能生成最低成本的执行计划（但往往不一定能），它决定对特定的查询使用哪些索引、哪些关联算法、操作执行顺序 从而使其高效运行。</p>
</blockquote>
<p>『Selinger 的论文』是查询优化领域的圣经，现在的系统在许多不同的角度显著地扩展了这篇论文的工作。</p>
<p>扩展的主要方向有：</p>
<ol>
<li>
<p>计划空间</p>
</li>
<li>
<p>选择性估算</p>
<ul>
<li>进行代价估算，从而选择优化的方向</li>
</ul>
</li>
<li>
<p>搜索算法</p>
<ul>
<li>
<p>有动态规划方法，也有自顶向下的搜索方法</p>
</li>
<li>
<p>MySQL 引擎的查询优化器在最后的检查是完全启发式的，而且大部分依赖于利用索引和键/外键约束</p>
</li>
</ul>
</li>
<li>
<p>并行</p>
</li>
<li>
<p>自动调优</p>
</li>
</ol>
<h3 id="查询执行器">查询执行器</h3>
<p>查询执行器操作一个完全具体的查询计划。</p>
<p>查询计划通常是一个把很多操作连接在一起的数据流图，这些操作封装了基本表的访问和各种查询方法，Graefe 的查询执行综述论文似乎很牛逼。</p>
<p>迭代器，查询执行器中比较重要的一个组件，迭代器的一个重要性能就是，<strong>它们连接了数据流和控制流</strong>。</p>
<p>数据在哪里？元组在内存中是如何存储的？数据是如何在迭代器之间传递的？</p>
<p>数据修改语句</p>
<ol>
<li>『万圣节问题』：更新和查询同时存在，更新会对之前更新过的行再次更新直到不满足条件</li>
<li>SQL 语义禁止这种行为：一个单一的 SQL 语句是不被允许“看到”自己的更新的</li>
</ol>
<h3 id="数据仓库">数据仓库</h3>
<p>简单介绍了数据仓库这种OLAP类型的数据库和传统数据库技术的区别</p>
<ul>
<li>
<p>位图索引</p>
</li>
<li>
<p>快速下载</p>
</li>
<li>
<p>物化视图</p>
</li>
<li>
<p>rollup (补充)</p>
</li>
<li>
<p>ad-hoc</p>
<ul>
<li>
<p>如何理解 大数据、数据仓库领域的ad-hoc这个词？ - Jerry Liu的回答 - 知乎https://www.zhihu.com/question/48734970/answer/490288838</p>
</li>
<li>
<p><a href="https://developer.aliyun.com/article/745881">数据库必知词汇：即席查询(Ad Hoc) </a></p>
</li>
</ul>
</li>
<li>
<p>雪花模式</p>
</li>
<li>
<p>星型模式</p>
</li>
</ul>
<h2 id="访问方法索引">访问方法/索引</h2>
<p>这部分就是索引部分，主要是B+Tree，HashTable等索引数据结构，这部分内容较多，之后会写一篇介绍数据库索引的博客，链接：</p>
<h2 id="存储管理">存储管理</h2>
<p>存储管理主要是基于“空间局部性”和“时间局部性”原理。</p>
<ul>
<li>
<p>空间局部性</p>
<ul>
<li>
<p>DBMS 不使用操作系统提供的接口，而是自己直接控制数据存储到磁盘设备中，从而控制数据的空间局部性。</p>
</li>
<li>
<p>预读取针对的是空间局部性，解析器了解接下来要读取哪里的数据，在真正读取之前就先将数据读取到缓冲上。</p>
</li>
</ul>
</li>
<li>
<p>时间局部性</p>
<ul>
<li>缓冲池(buffer pool)针对的是时间局部性问题：被访问的页面，在短时间内很可能再次被访问。因此将其暂时保存到内存上。</li>
</ul>
</li>
</ul>
<h2 id="事务并发控制和恢复">事务：并发控制和恢复</h2>
<h4 id="事务存储管理器四大组件">事务存储管理器四大组件</h4>
<ol>
<li>
<p>锁管理器：并发控制</p>
</li>
<li>
<p>日志管理器：事务恢复</p>
</li>
<li>
<p>IO缓冲池：利用局部性加速访问 5. 存储管理</p>
<p>这一组件相对其它三个组件比较独立；其他三个组件的相互依赖比较明显</p>
</li>
<li>
<p>组织磁盘数据的访问方法（即索引）</p>
</li>
</ol>
<h4 id="重要概念">重要概念</h4>
<ul>
<li>
<p>ACID</p>
<ul>
<li>
<p>原子性</p>
</li>
<li>
<p>一致性</p>
</li>
<li>
<p>隔离性（可以大作文章）</p>
</li>
<li>
<p>持久性</p>
</li>
</ul>
</li>
<li>
<p>可串行化</p>
</li>
<li>
<p>并发控制技术</p>
<ul>
<li>
<p>两阶段锁 2PL</p>
</li>
<li>
<p>多版本并发控制 MVCC</p>
</li>
<li>
<p>乐观并发控制 OCC</p>
</li>
</ul>
</li>
<li>
<p>事务隔离级别
多套体系，普遍了解的是第一种（SQL标准），所以了解其他更完善的体系很有价值（两篇相关论文）。</p>
<blockquote>
<ol>
<li>A Critique of ANSI SQL Isolation Levels</li>
<li>Generalized Isolation Level Definitions</li>
</ol>
</blockquote>
</li>
</ul>
<h4 id="重要结构">重要结构</h4>
<ol>
<li>
<p>锁（lock）和锁存器(latch)</p>
<p>lock和latch都是锁的功能，但是在数据库中有很大区别。lock的服务对象是事务，在事务并发中使用。而latch的服务对象是线程，在线程并发时使用，更接近操作系统中的锁，是更底层的保护内存数据结构的锁。</p>
</li>
<li>
<p>日志管理器</p>
</li>
<li>
<p>索引的锁和其日志</p>
</li>
</ol>
<h2 id="共享组件">共享组件</h2>
<ol>
<li>
<p>目录管理器</p>
<p>管理表等的元数据，目录</p>
</li>
<li>
<p>内存分配器</p>
<p>DBMS可以选择使用不同的内存分配器（如tcmalloc，jemalloc等）进行内存分配</p>
</li>
</ol>
<h2 id="一个sql的完整生命周期">一个SQL的完整生命周期</h2>
<ol>
<li>
<p>一个SQL从客户端编写，并发送到服务器的数据库系统上</p>
</li>
<li>
<p>DBMS的通信管理器接收到客户端的SQL之后，使用进程管理器为其分配一个处理线程</p>
</li>
<li>
<p>查询被交给查询处理器，对SQL进行解析与优化处理</p>
<ul>
<li>
<p>解析SQL，词法分析，语法分析，生成中间表示</p>
</li>
<li>
<p>进行查询重写，查询优化，生成查询计划</p>
</li>
<li>
<p>查询执行器对查询操作进行执行，如：连接、选择、投影、聚集、排序；</p>
</li>
</ul>
</li>
<li>
<p>查询会从DBMS的存储管理器中获得数据</p>
<ul>
<li>存储管理器包括管理磁盘数据的基本算法和数据结构，比如表和索引</li>
<li>存储管理器还包括缓冲管理器，事务管理器，日志管理器，锁管理器</li>
</ul>
</li>
<li>
<p>将SQL查询结果通过通信管理器返回给客户端</p>
</li>
</ol>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">姬小野</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2021-08-22
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="../../../tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="../../../post/cmu15-445/%E7%B4%A2%E5%BC%95/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">CMU 15-445笔记: 索引</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="../../../post/2021-10-8%E5%89%8D%E7%9A%84%E5%8D%9A%E5%AE%A2/gfs/">
            <span class="next-text nav-default">GFS文件系统</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://blog.csdn.net/wjh2622075127" class="iconfont icon-csdn" title="csdn"></a>
      <a href="https://github.com/JameyWoo" class="iconfont icon-github" title="github"></a>
  <a href="https://fiveplus.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2018 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>姬小野</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="../../../js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js" integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin="anonymous"></script>








</body>
</html>
